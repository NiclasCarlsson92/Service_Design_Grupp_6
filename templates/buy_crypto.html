{% extends "base-template.html" %}

{% block title %}
    Dashboard
{% endblock %}

{% block content %}
    {% if current_user.is_authenticated %}
        <h1>User: {{ current_user.name }}</h1>
    {% endif %}
    <h1 id="main-heading">Today's Cryptocurrency Prices by Market Cap</h1>
    <br />
    <table class="center">
        <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Held</th>
        </tr>
           {% for key, value in cryptos.items() %}
               <tr>
                <td>{{key}}</td>
                <td id="{{ key }}">{{value}}</td>
                <td>{{wallet[key]}}</td>
               </tr>

           {% endfor %}
    </table>
    <br/>
    <br/>
    <a class="your-balance">
        Your balance: {{ current_user.current_balance }}$
    </a>
    <form>
        <label for="crypto">Crypto</label>
        <input type="text" name="crypto" id="crypto">

        <label for="amount">Amount USD</label>
        <input type="text" name="amount" id="amount">

        <button class="sbutton button1" type="submit">Buy</button>
    </form>



{% endblock %}

{% block scripts %}
 <script>
        setInterval(checkMessages, 15000);

        function checkMessages() {
            fetch("http://127.0.0.1:5000/api/v.1/cryptousd")
            .then(response => response.json())
            .then(crypto => {
                let btc = crypto.BTC;
                let eth = crypto.ETH;
                let usdt = crypto.USDT;
                let bnb = crypto.BNB;
                let usdc = crypto.USDC;
                document.getElementById("BTC").innerHTML = btc;
                document.getElementById("ETH").innerHTML = eth;
                document.getElementById("USDT").innerHTML = usdt;
                document.getElementById("BNB").innerHTML = bnb;
                document.getElementById("USDC").innerHTML = usdc;
            });
        }
        function handleSubmit(event) {
        event.preventDefault();

        const data = new FormData(event.target);

        const value = Object.fromEntries(data.entries());

        // console.log({ value });
        fetch("http://127.0.0.1:5000/api/v.1/buy", {
            method: 'PUT',
            body: JSON.stringify(value)})
      }
      const form = document.querySelector('form');
      form.addEventListener('submit', handleSubmit);



    </script>
{% endblock %}